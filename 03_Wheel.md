# Wheel Equations

## 1. Torque Equation

We can derive equations for a wheel used in either a shooter or an intake.  
One could just stick with angular motion, but we can determine the linear velocity of a projectile object or an object fed into a robot via an intake by determining the linear kinematics.  
This will ignore inefficiencies in motion transfer for the sake of simplicity.

Also I would not use this for a drivetrain wheel.  Whether it be differential/mecanum/swerve.  There are other factors at play with drivetrains.

Let's start with the torque equation for the gearbox from the previous section.  

> $\Large \tau_g = nGK_tI_m - \tau_{s_{m}}nG^2sgn(\omega_g)$

### Variable Definitions

#### Motor

* $\Large I_m$ : Electrical current running through the motor. Measured in Amperes (Amps): $\Large A$
* $\Large V_m$: Potential difference (Voltage) applied across the motor's terminals.  Measured in Volts: $\Large V$
* $\Large K_t$ : Motor-torque constant. Measured in Newton-Meters per Amp: $\Large \frac{Nm}{A}$
* $\Large K_v$: Motor-velocity constant. Measured in Radians per Second per Volt: $\Large \frac{rad}{sV}$
* $\Large \tau_{s_{m}}$ : Torque due to static friction on the motor. Measured in Newton-Meters: $\Large Nm$.

#### Gearbox

* $\Large G$ : The gear ratio (reduction | gear ratio | gearing). The ratio of input (motor) rotations to output (
  gearbox) rotations. Unitless quantity. Values larger than 1 indicate that the gearbox output rotations are smaller
  than the motor input rotations.
* $\Large n$ : The number of identical motors in the gearbox. Unitless 01
* $\Large \tau_G$ : Torque generated by the gearbox. Measured in Newton-Meters: $\Large Nm$.
* $\Large \omega_G$ : Angular velocity of the gearbox's output shaft. Measured in Radians per
  Second: $\Large \frac{rad}{s}$
* $\Large F_s$ : The static force of friction from the wheel.

#### Wheel

* $\Large F$ : Force acting on the object by the wheel. Measured in Newtons: $\Large N$.
* $\Large r$ : Radius of the wheel. Measure in meters: $\Large m$.
* $\Large v$ : Velocity of the object given to it by the wheel. Measured in Meters per Second: $\Large \frac{m}{s}$

## 2. Force Equation

The force acting on an object is a product of torque and moment arm.  In this case the moment arm is the radius of the wheel.  

> $\Large \tau_g = rF$

We can also define the following

> $\Large \tau_{s_{m}} = rF_s$

This allows us to derive the following.

> $\Large \tau_g = nGK_tI_m - \tau_{s_{m}}nG^2sgn(\omega_g)$
> 
> $\Large rF = nGK_tI_m - rF_snG^2sgn(\omega_g)$

The velocity of the wheel is determined by

> $\Large v = r\omega_g$
> 
> $\Large w_g = \frac{v}{r}$

Giving us.

> $\Large rF = nGK_tI_m - rF_snG^2sgn(\frac{v}{r})$
> 
> $\Large rF = nGK_tI_m - \frac{1}{r}rF_snG^2sgn(v)$
> 
> $\Large rF = nGK_tI_m - F_snG^2sgn(v)$
>
> $\Large F = \frac{nGK_tI_m}{r} - \frac{F_snG^2}{r}sgn(v)$
 


## 3. Acceleration Equation

### Variable Definitions

* $\Large a$ : Acceleration of the object given to it by the wheel. Measured in Meters Per Second Squared: $\Large \frac{m}{s^2}$
* $\Large m$ : Mass of the object. Measured in Kilograms: $\Large kg$


The net force on an object is a product of the object's mass and acceleration.

> $\Large F = ma$

This can be used to solve for the acceleration of the object by the wheel in terms of current and velocity. 

> $\Large F = \frac{nGK_tI_m}{r} - \frac{F_snG^2}{r}sgn(v)$
>
> $\Large F = \frac{nGK_tI_m}{r} - \frac{F_snG^2}{r}sgn(v)$

## 4. System Characterization Model (SysId)

### Variable Definitions

* $\Large k_s$ : Static friction gain constant:  Measured in Amps: $\Large A$
* $\Large k_v$ : Velocity gain constant (Please note the difference between $\Large k_v$ and $\Large K_v$. Measured in Amps per Radians Per Second: $\Large \frac{As}{rad}$
* $\Large k_a$ : Acceleration gain constant
* $\Large x$ : The state variable (angular position in our case). Measured in Amps per Radians Per Second Squared: $\Large \frac{As^2}{rad}$
* $\Large \dot{x}$: The rate of change of the $\Large x$ (angular velocity in our case)
* $\Large \ddot{x}$: The rate of change of $\Large \dot{x}$ (angular acceleration in our case)
* $\Large u$ : The input used to control the state (current or voltage)

WPILib provides a utility called SysId that will help with determining how best to control the state of the system.  
For the gearbox (Simple setting) the software assumes the following affine model.  

> $\Large u = k_ssgn(\dot{x}) + k_v\dot{x} + k_a\ddot{x}$

Solving for $\Large \ddot{x}$ gives us.

> $\Large k_a\ddot{x} = -k_v\dot{x} + u - k_ssgn(\dot{x})$
> 
> $\Large \ddot{x} = -\frac{k_v}{k_a} \dot{x} + \frac{1}{k_a}u - \frac{k_s}{k_a}sgn(\dot{x})$

## 5. Current Control Model

We can make the following substitutions in the SysId equation to evaluate the characterization constants.

> $\Large \dot{x} = \omega_g$, $\Large \ddot{x} = \alpha_g$, $\Large u = I_m$
> 
> $\Large \alpha_g = -\frac{k_v}{k_a} \omega_g + \frac{1}{k_a}I_m - \frac{k_s}{k_a}sgn(\omega_g)$

Since $\Large \alpha_g$ doesn't have an $\Large \omega_g$ term then 

> $\Large \frac{-k_v}{k_a} = 0$, $\Large k_v = 0$

Matching the $\Large I_m$ terms gives us.

> $\Large \frac{1}{k_a} = \frac{nGK_t}{J}$, $\Large k_a = \frac{J}{nGK_t}$

The torque due to static friction needs to be determined experimentally.  However $\Large k_s$ which is determined by SysId is related to the static friction torque as follows.

> $\Large \frac{k_s}{k_a} = \frac{\tau_{s_{m}}nG^2}{J}$
> 
> $\Large k_s\frac{1}{k_a} = k_s\frac{nGK_t}{J} = \frac{\tau_{s_{m}}nG^2}{J}$
> 
> $\Large k_s = \frac{J}{nGK_t}\frac{\tau_{s_{m}}nG^2}{J}$
> 
> $\Large k_s = \frac{\tau_{s_{m}}G}{K_t}$

## 6. Voltage Control Model

Returning our attention to this equation.

> $\Large \alpha_g = \frac{nGK_t}{J}I_m - \frac{\tau_{s_{m}}nG^2}{J}sgn(\omega_g)$

along with this equation from Part 01

> $\Large I_m = \frac{V_m}{R} - \frac{\omega_m}{RK_v}$

We can substitute $\Large I_m$ into the acceleration equation and derive a voltage control model.  

> $\Large \alpha_g = \frac{nGK_t}{J}(\frac{V_m}{R} - \frac{\omega_m}{RK_v}) - \frac{\tau_{s_{m}}nG^2}{J}sgn(\omega_g)$
> 
> $\Large \alpha_g = \frac{nGK_t}{RJ}V_m - \frac{nGK_t}{RJK_v}\omega_m - \frac{\tau_{s_{m}}nG^2}{J}sgn(\omega_g)$
> 
> $\Large \alpha_g = \frac{nGK_t}{RJ}V_m - \frac{nGK_t}{RJK_v}G\omega_g - \frac{\tau_{s_{m}}nG^2}{J}sgn(\omega_g)$
> 
> $\Large \alpha_g = \frac{nGK_t}{RJ}V_m - \frac{nG^2K_t}{RJK_v}\omega_g - \frac{\tau_{s_{m}}nG^2}{J}sgn(\omega_g)$

Performing the following substitutions we can derive the characterization constants $\Large k_s$, $\Large k_v$, and $\Large k_a$

> $\Large \ddot{x} = -\frac{k_v}{k_a} \dot{x} + \frac{1}{k_a}u - \frac{k_s}{k_a}sgn(\dot{x})$
>
> $\Large \dot{x} = \omega_g$, $\Large \ddot{x} = \alpha_g$, $\Large u = V_m$
> 
> $\Large \alpha_g = -\frac{k_v}{k_a} \omega_g + \frac{1}{k_a}V_m - \frac{k_s}{k_a}sgn(\omega_g)$

Matching the $\Large V_m$ terms gives us 

> $\Large \frac{1}{k_a} = \frac{nGK_t}{RJ}$
> 
> $\Large k_a = \frac{RJ}{nGK_t}$

Matching the $\Large \omega_g$ terms gives us 

> $\Large \frac{k_v}{k_a} = \frac{nG^2K_t}{RJK_v}$
> 
> $\Large k_v\frac{1}{k_a} = \frac{nG^2K_t}{RJK_v}$
> 
> $\Large k_v\frac{nGK_t}{RJ} = \frac{nG^2K_t}{RJK_v}$
> 
> $\Large k_v = \frac{G}{K_v}$

The torque due to static friction needs to be determined experimentally.  However $\Large k_s$ which is determined by SysId is related to the static friction torque as follows.

> $\Large \frac{k_s}{k_a} = \frac{\tau_{s_{m}}nG^2}{J}$
> 
> $\Large k_s\frac{1}{k_a} = k_s\frac{nGK_t}{RJ} = \frac{\tau_{s_{m}}nG^2}{J}$
> 
> $\Large k_s = \frac{RJ}{nGK_t}\frac{\tau_{s_{m}}nG^2}{J}$
> 
> $\Large k_s = \frac{\tau_{s_{m}}RG}{K_t}$
